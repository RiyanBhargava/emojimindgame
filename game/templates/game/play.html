{% extends "game/base.html" %}

{% block content %}
<div class="game-container fade-in">
    <!-- Game Header -->
    <div class="card game-header">
        <div class="difficulty-badge difficulty-{{ difficulty }}">
            {% if difficulty == 'easy' %}ğŸ˜Š Easy
            {% elif difficulty == 'medium' %}ğŸ¤” Medium  
            {% else %}ğŸ˜¤ Hard{% endif %}
        </div>
    </div>

    <!-- Game Challenge -->
    <div class="card challenge-card">
        <h2 class="word-display pulse">ğŸ¯ {{ word|title }}</h2>
        <p class="challenge-text">
            Describe this word using up to <strong>{{ emoji_limit }} emojis</strong>.
            Make the AI guess exactly what you're thinking! ğŸ¤–âœ¨
        </p>
        
        <!-- Progress Indicators -->
        <div class="game-info">
            <div class="info-item">
                <div class="info-icon">ğŸ¯</div>
                <div class="info-text">
                    <span class="info-label">Tries Left</span>
                    <span class="info-value">{{ tries_left }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji Input -->
    <div class="card input-card">
        <form method="post" id="emoji-form">
            {% csrf_token %}
            <div class="input-group">
                <label for="{{ form.emojis.id_for_label }}" class="input-label">
                    ğŸ’¡ Your Emoji Clues
                </label>
                <div class="emoji-input-container">
                    {{ form.emojis }}
                    <div class="input-hint">
                        Think creatively! What emojis represent "{{ word }}"? ğŸ¨
                    </div>
                </div>
                {% if form.emojis.errors %}
                    <div class="error-message">
                        {% for error in form.emojis.errors %}
                            <div class="error-item">âŒ {{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <button type="submit" class="btn btn-primary btn-lg submit-btn pulse" id="submit-btn">
                ğŸš€ Challenge the AI
            </button>
        </form>

        {% if error_message %}
        <div class="alert alert-error fade-in">
            <span class="alert-icon">âš ï¸</span>
            <span class="alert-text">{{ error_message }}</span>
        </div>
        {% endif %}
    </div>

    <!-- Game Tips -->
    <div class="card tips-card fade-in">
        <h3>ğŸ’¡ Strategic Tips</h3>
        <div class="tips-grid">
            <div class="tip-item">
                <span class="tip-emoji">ğŸ¯</span>
                <span class="tip-text">Be specific - generic emojis confuse the AI</span>
            </div>
            <div class="tip-item">
                <span class="tip-emoji">ğŸ”—</span>
                <span class="tip-text">Use related concepts the AI might connect</span>
            </div>
            <div class="tip-item">
                <span class="tip-emoji">âš¡</span>
                <span class="tip-text">Quick thinking gets bonus points!</span>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Scripts -->
<script>
    // Enhanced timer for play page
    {% if timer %}
    const startTime = new Date("{{ timer }}").getTime();
    const endTime = startTime + 10*60*1000;
    
    function updateTimerDisplay() {
        const now = new Date().getTime();
        let distance = endTime - now;
        if (distance < 0) distance = 0;
        
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        const timerElement = document.getElementById("timer_display");
        const timeString = ("0"+minutes).slice(-2) + ":" + ("0"+seconds).slice(-2);
        
        // Add urgency effects
        if (distance < 60000) { // Last minute
            timerElement.innerHTML = "ğŸš¨ " + timeString;
            timerElement.style.color = "#ff4757";
            timerElement.style.animation = "pulse 1s infinite";
        } else if (distance < 180000) { // Last 3 minutes
            timerElement.innerHTML = "â° " + timeString;
            timerElement.style.color = "#ffa502";
        } else {
            timerElement.innerHTML = "â° " + timeString;
        }
        
        if (distance > 0) {
            setTimeout(updateTimerDisplay, 1000);
        } else {
            timerElement.innerHTML = "â° Time's Up!";
            // Disable form
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('submit-btn').innerHTML = "â° Time Expired";
        }
    }
    updateTimerDisplay();
    {% endif %}

    // Form enhancements
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('emoji-form');
        const input = document.querySelector('#{{ form.emojis.id_for_label }}');
        const submitBtn = document.getElementById('submit-btn');

        // Real-time emoji counting
        if (input) {
            input.addEventListener('input', function() {
                const emojiCount = (this.value.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu) || []).length;
                const maxEmojis = {{ emoji_limit }};
                
                if (emojiCount > maxEmojis) {
                    this.style.borderColor = '#ff4757';
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = 'âŒ Too many emojis (' + emojiCount + '/' + maxEmojis + ')';
                } else {
                    this.style.borderColor = 'var(--primary)';
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'ğŸš€ Challenge the AI (' + emojiCount + '/' + maxEmojis + ')';
                }
            });

            // Focus effects
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'scale(1.02)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.style.transform = 'scale(1)';
            });
        }

        // Form submission effects
        form.addEventListener('submit', function(e) {
            submitBtn.innerHTML = 'ğŸ¤– AI is thinking...';
            submitBtn.disabled = true;
            addEmojiEffect('ğŸ¯');
        });

        // Add emoji picker hint
        if (input) {
            input.placeholder = 'ğŸ¯ Enter your emoji clues here... ğŸ¨âœ¨ğŸš€';
        }
    });
</script>

<style>
    /* Play-specific enhancements */
    .word-display {
        font-size: 2.5rem;
        text-align: center;
        color: var(--primary);
        text-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        margin: 1rem 0;
    }
    
    .emoji-input-container input {
        font-size: 1.5rem;
        line-height: 2;
        min-height: 80px;
        text-align: center;
    }
    
    .game-timer {
        font-size: 1.25rem;
        font-weight: bold;
    }
    
    .difficulty-badge {
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-weight: bold;
        color: white;
    }
    
    .difficulty-easy { background: linear-gradient(135deg, #2ed573, #1e90ff); }
    .difficulty-medium { background: linear-gradient(135deg, #ffa502, #ff6348); }
    .difficulty-hard { background: linear-gradient(135deg, #ff4757, #c44569); }
    
    @media (max-width: 480px) {
        .word-display {
            font-size: 2rem;
        }
        
        .emoji-input-container input {
            font-size: 1.25rem;
            min-height: 60px;
        }
    }
</style>
{% endblock %}